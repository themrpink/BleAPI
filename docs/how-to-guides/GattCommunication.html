<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gatt communication &mdash; CosmedBleLib 1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Helper Methods" href="HelperMethods.html" />
    <link rel="prev" title="Gatt Discovery Services" href="GattDiscovery.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> CosmedBleLib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="QuickStart.html">QuickStart</a></li>
<li class="toctree-l1"><a class="reference internal" href="PackageDiagram.html">Package Diagram</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="DiscoveringDevices.html">Discovering devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="Filter.html">Filtering advertising devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="Pairing.html">Pairing and unpairing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GattDiscovery.html">Gatt Discovery Services</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Gatt communication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#writewithresult">WriteWithResult</a></li>
<li class="toctree-l2"><a class="reference internal" href="#read">Read</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subscribetonotification">SubscribeToNotification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subscribetoindication">SubscribeToIndication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unsubscribe">Unsubscribe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#addcharacteristictoreliablewrite">AddCharacteristicToReliableWrite</a></li>
<li class="toctree-l2"><a class="reference internal" href="#errorfoundclass">ErrorFoundClass</a></li>
<li class="toctree-l2"><a class="reference internal" href="#valuechangedaction">valueChangedAction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="HelperMethods.html">Helper Methods</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Troubleshooting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="issues.html">Known issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="../api_documentation/html/index.html#http://">Cosmed API Documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.microsoft.com/en-us/windows/uwp/devices-sensors/bluetooth-low-energy-overview">Microsoft UWP BLE Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CosmedBleLib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Gatt communication</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/GattCommunication.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gatt-communication">
<h1>Gatt communication<a class="headerlink" href="#gatt-communication" title="Permalink to this headline"></a></h1>
<p>The Library adds to the Uwp class <a class="reference external" href="https://docs.microsoft.com/en-us/uwp/api/windows.devices.bluetooth.genericattributeprofile.gattcharacteristic?view=winrt-22000">GattCharacteristic</a> some useful extension method to execute the operations that allow Gatt communication.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/characteristic.png"><img alt="_images/characteristic.png" src="_images/characteristic.png" style="width: 609.0px; height: 184.2px;" /></a>
</figure>
<p>The methods have the following signatures:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Write</span>
<span class="n">Task</span><span class="p">&lt;</span><span class="n">CosmedCharacteristicWriteResult</span><span class="p">&gt;</span> <span class="n">WriteWithResult</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="k">value</span><span class="p">,</span> <span class="n">GattWriteOption</span> <span class="n">writeOption</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">CosmedGattErrorFoundEventArgs</span><span class="p">&gt;</span> <span class="n">errorAction</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>

<span class="c1">//Read</span>
<span class="n">Task</span><span class="p">&lt;</span><span class="n">CosmedCharacteristicReadResult</span><span class="p">&gt;</span> <span class="n">Read</span><span class="p">(</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">CosmedGattErrorFoundEventArgs</span><span class="p">&gt;</span> <span class="n">errorAction</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>

<span class="c1">//Subscribe to Notification</span>
<span class="n">Task</span><span class="p">&lt;</span><span class="n">CosmedGattCommunicationStatus</span><span class="p">&gt;</span> <span class="n">SubscribeToNotification</span><span class="p">(</span><span class="n">TypedEventHandler</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">GattValueChangedEventArgs</span><span class="p">&gt;</span> <span class="n">valueChangedAction</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">CosmedGattErrorFoundEventArgs</span><span class="p">&gt;</span> <span class="n">errorAction</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>

<span class="c1">//Subscribe to Indication</span>
<span class="n">Task</span><span class="p">&lt;</span><span class="n">CosmedGattCommunicationStatus</span><span class="p">&gt;</span> <span class="n">SubscribeToIndication</span><span class="p">(</span><span class="n">TypedEventHandler</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">GattValueChangedEventArgs</span><span class="p">&gt;</span> <span class="n">valueChangedAction</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">CosmedGattErrorFoundEventArgs</span><span class="p">&gt;</span> <span class="n">errorAction</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>

<span class="c1">//Unsubscribe</span>
<span class="n">Task</span><span class="p">&lt;</span><span class="n">CosmedGattCommunicationStatus</span><span class="p">&gt;</span> <span class="n">UnSubscribe</span><span class="p">(</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">CosmedGattErrorFoundEventArgs</span><span class="p">&gt;</span> <span class="n">errorAction</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>

<span class="c1">//Add the calling Characteristic to Reliable Write Transaction</span>
<span class="k">void</span> <span class="nf">AddCharacteristicToReliableWrite</span><span class="p">(</span><span class="n">GattReliableWriteTransaction</span> <span class="n">reliableWriteTransaction</span><span class="p">,</span> <span class="n">IBuffer</span> <span class="k">value</span><span class="p">)</span>
</pre></div>
</div>
<section id="writewithresult">
<h2>WriteWithResult<a class="headerlink" href="#writewithresult" title="Permalink to this headline"></a></h2>
<p>This method writes a value to the Characteristic, if Write operation is allowed. The method checks that and will eventually specify it in the returned result, but it’s also possible to verify before calling the method:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Checks if Write is allowed for the calling Characteristic</span>
<span class="kt">bool</span> <span class="n">result</span> <span class="p">=</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">IsWriteAllowed</span><span class="p">();</span>
</pre></div>
</div>
<p>The WriteWithResult method takes the following parameters:</p>
<ul class="simple">
<li><dl class="simple">
<dt>byte[] value:</dt><dd><ul>
<li><p>the value to be written. The size should not exceed the supported payload capacity</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>GattWriteOption writeOption:</dt><dd><ul>
<li><p>can be WriteWithoutResponse or WriteWithResponse</p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/uwp/api/windows.devices.bluetooth.genericattributeprofile.gattwriteoption?view=winrt-22000">See GattWriteOption</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Action&lt;GattCharacteristic, CosmedGattErrorFoundEventArgs&gt; errorAction = null:</dt><dd><ul>
<li><p>optional parameter, see <a class="reference internal" href="#errorfoundclass"><span class="std std-ref">ErrorFoundClass</span></a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">//prepares the value to write</span>
<span class="kt">byte</span><span class="p">[]</span> <span class="k">value</span> <span class="p">=</span> <span class="p">{</span> <span class="m">0</span><span class="n">x001</span> <span class="p">};</span>

<span class="c1">//write with response</span>
<span class="n">CosmedCharacteristicWriteResult</span> <span class="n">write</span> <span class="p">=</span> <span class="k">await</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">WriteWithResult</span><span class="p">(</span><span class="k">value</span><span class="p">,</span> <span class="n">GattWriteOption</span><span class="p">.</span><span class="n">WriteWithResponse</span><span class="p">);</span>

<span class="c1">//write without response</span>
<span class="n">CosmedCharacteristicWriteResult</span> <span class="n">write2</span> <span class="p">=</span> <span class="k">await</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">WriteWithResult</span><span class="p">(</span><span class="k">value</span><span class="p">,</span> <span class="n">GattWriteOption</span><span class="p">.</span><span class="n">WriteWithoutResponse</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="read">
<h2>Read<a class="headerlink" href="#read" title="Permalink to this headline"></a></h2>
<p>This method reads the value from the calling Characteristic object, if Read operation is allowed. The method checks that and will eventually specify it in the returned result, but it’s also possible to verify before calling the method:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Checks if read operation is allowed for the calling Characteristic</span>
<span class="kt">bool</span> <span class="n">result</span> <span class="p">=</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">IsReadAllowed</span><span class="p">();</span>
</pre></div>
</div>
<p>The Read method takes the following parameter:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Action&lt;GattCharacteristic, CosmedGattErrorFoundEventArgs&gt; errorAction = null:</dt><dd><ul>
<li><p>optional parameter, see <a class="reference internal" href="#errorfoundclass"><span class="std std-ref">ErrorFoundClass</span></a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">CosmedCharacteristicReadResult</span> <span class="n">read</span> <span class="p">=</span> <span class="k">await</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">Read</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="subscribetonotification">
<h2>SubscribeToNotification<a class="headerlink" href="#subscribetonotification" title="Permalink to this headline"></a></h2>
<p>This method subscribes to notifications to the calling Characteristic object, if Notify operation is allowed. The method checks that and will eventually specify it in the returned result, but it’s also possible to verify before calling the method:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Checks if Notify operation is allowed for the calling Characteristic</span>
<span class="kt">bool</span> <span class="n">result</span> <span class="p">=</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">IsNotificationAllowed</span><span class="p">();</span>
</pre></div>
</div>
<p>The SubscribeToNotifications method takes the following parameters:</p>
<ul class="simple">
<li><dl class="simple">
<dt>TypedEventHandler&lt;GattCharacteristic, GattValueChangedEventArgs&gt; valueChangedAction:</dt><dd><ul>
<li><p>see <a class="reference internal" href="#valuechangedaction"><span class="std std-ref">valueChangedAction</span></a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Action&lt;GattCharacteristic, CosmedGattErrorFoundEventArgs&gt; errorAction = null:</dt><dd><ul>
<li><p>optional parameter, see <a class="reference internal" href="#errorfoundclass"><span class="std std-ref">ErrorFoundClass</span></a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">CosmedGattCommunicationStatus</span> <span class="n">ntfSubResult</span> <span class="p">=</span> <span class="k">await</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">SubscribeToNotification</span><span class="p">(</span>
<span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;notification:&quot;</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Timestamp</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
            <span class="n">IBuffer</span> <span class="n">CharacteristicValue</span> <span class="p">=</span> <span class="n">a</span><span class="p">.</span><span class="n">CharacteristicValue</span><span class="p">;</span>
            <span class="kt">string</span> <span class="n">val</span> <span class="p">=</span> <span class="n">ClientBufferReader</span><span class="p">.</span><span class="n">ToUTF8String</span><span class="p">(</span><span class="n">CharacteristicValue</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;buffer content: &quot;</span> <span class="p">+</span> <span class="n">val</span><span class="p">);</span>
          <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="subscribetoindication">
<h2>SubscribeToIndication<a class="headerlink" href="#subscribetoindication" title="Permalink to this headline"></a></h2>
<p>This method subscribes to indications to the calling Characteristic object, if Indicate operation is allowed. The method checks that and will eventually specify it in the returned result, but it’s also possible to verify before calling the method:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Checks if Indicate operation is allowed for the calling Characteristic</span>
<span class="kt">bool</span> <span class="n">result</span> <span class="p">=</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">IsIndicationAllowed</span><span class="p">();</span>
</pre></div>
</div>
<p>The SubscribeToIndications method takes the following parameters:</p>
<ul class="simple">
<li><dl class="simple">
<dt>TypedEventHandler&lt;GattCharacteristic, GattValueChangedEventArgs&gt; valueChangedAction:</dt><dd><ul>
<li><p>see <a class="reference internal" href="#valuechangedaction"><span class="std std-ref">valueChangedAction</span></a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Action&lt;GattCharacteristic, CosmedGattErrorFoundEventArgs&gt; errorAction = null:</dt><dd><ul>
<li><p>optional parameter, see <a class="reference internal" href="#errorfoundclass"><span class="std std-ref">ErrorFoundClass</span></a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">CosmedGattCommunicationStatus</span> <span class="n">indSubResult</span> <span class="p">=</span> <span class="k">await</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">SubscribeToIndication</span><span class="p">(</span>
 <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;indication:&quot;</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Timestamp</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
             <span class="n">IBuffer</span> <span class="n">CharacteristicValue</span> <span class="p">=</span> <span class="n">a</span><span class="p">.</span><span class="n">CharacteristicValue</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">val</span> <span class="p">=</span> <span class="n">ClientBufferReader</span><span class="p">.</span><span class="n">ToUTF8String</span><span class="p">(</span><span class="n">CharacteristicValue</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;buffer content: &quot;</span> <span class="p">+</span> <span class="n">val</span><span class="p">);</span>
           <span class="p">}</span>
 <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="unsubscribe">
<h2>Unsubscribe<a class="headerlink" href="#unsubscribe" title="Permalink to this headline"></a></h2>
<p>This method unsubscribes from notifications and indications from the calling Characteristic object, if Notify or Indicate operation is allowed. The method checks that and will eventually specify it in the returned result, but it’s also possible to verify before calling the method:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">CosmedGattCommunicationStatus</span> <span class="n">unsubResult</span> <span class="p">=</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">UnSubscribe</span><span class="p">();</span>
</pre></div>
</div>
<p>The SubscribeToNotifications method takes the following parameters:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Action&lt;GattCharacteristic, CosmedGattErrorFoundEventArgs&gt; errorAction = null:</dt><dd><ul>
<li><p>optional parameter, see <a class="reference internal" href="#errorfoundclass"><span class="std std-ref">ErrorFoundClass</span></a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="addcharacteristictoreliablewrite">
<h2>AddCharacteristicToReliableWrite<a class="headerlink" href="#addcharacteristictoreliablewrite" title="Permalink to this headline"></a></h2>
<p>This method takes as arguments the GattReliableWriteTransaction to which we want to add the write operation and the value we want to write.</p>
<ul class="simple">
<li><p>For an example see <a class="reference internal" href="GattDiscovery.html#reliable-write"><span class="std std-ref">Reliable write</span></a></p></li>
</ul>
</section>
<section id="errorfoundclass">
<h2>ErrorFoundClass<a class="headerlink" href="#errorfoundclass" title="Permalink to this headline"></a></h2>
<p>This static class offers an event (ErrorFoundClass.ErrorFound), shared by all the operations methods listed above to manage errors and exceptions raised during any communication call.
The user can subscribe an error handler to this event, managing the exceptions in the same way for every operation with any characteristic during the same session.
To hanlde a specific operation of a specific characteristic a custom event handler can instead be passed to any of the four operations methods plus the unsubscribe method.</p>
<p>If neither the static event ErrorFoundClass.ErrorFound nor the custom one passed as parameter are used, the user will not receive a notification in case of exception,
but the exception will still be silently catched ánd the result of the operation marked as Unreachable in the returned operation Result.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">// option 1:</span>
<span class="c1">//use of the generic error event</span>
<span class="c1">//create the handler</span>
<span class="n">Action</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">CosmedGattErrorFoundEventArgs</span><span class="p">&gt;</span> <span class="n">ErrorHandler</span> <span class="p">=</span>
     <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;exception catched from communication with characteristic &quot;</span> <span class="p">+</span> <span class="n">s</span><span class="p">.</span><span class="n">Uuid</span><span class="p">);</span>

<span class="c1">//subscribe to the static event, just once for all the operation on the same session</span>
<span class="n">ErrorFoundClass</span><span class="p">.</span><span class="n">ErrorFound</span> <span class="p">+=</span> <span class="n">ErrorHandler</span><span class="p">;</span>

<span class="c1">//if an excetion occurs the ErrorHandler will be invoked</span>
<span class="n">characteristic</span><span class="p">.</span><span class="n">Read</span><span class="p">();</span>

<span class="c1">//before closing the session, unsubscribe</span>
<span class="n">ErrorFoundClass</span><span class="p">.</span><span class="n">ErrorFound</span> <span class="p">-=</span> <span class="n">ErrorHandler</span><span class="p">;</span>

<span class="c1">// option 2:</span>
<span class="c1">//use of a handler as parameter for each operation that should have a specific temporary handler</span>
<span class="n">Action</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">CosmedGattErrorFoundEventArgs</span><span class="p">&gt;</span> <span class="n">TemporaryErrorHandler</span> <span class="p">=</span>
     <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;exception catched from communication with characteristic &quot;</span> <span class="p">+</span> <span class="n">s</span><span class="p">.</span><span class="n">Uuid</span><span class="p">);</span>

<span class="c1">//the passed hanlder will be used, and automatically unsubscribed after the method call</span>
<span class="n">characteristic</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">TemporaryErrorHandler</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="valuechangedaction">
<h2>valueChangedAction<a class="headerlink" href="#valuechangedaction" title="Permalink to this headline"></a></h2>
<p>This is a parameter for the SubscribeToNotification and SubscribeToIndication methods:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">TypedEventHandler</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">GattValueChangedEventArgs</span><span class="p">&gt;</span> <span class="n">valueChangedAction</span>
</pre></div>
</div>
<p>It’s the event handle that will receive the notifications or indications to which the user has subscribed.</p>
<p>Example:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">//this event hanlder will print to the console the time and the value of each received notification</span>
<span class="n">TypedEventHandler</span><span class="p">&lt;</span><span class="n">GattCharacteristic</span><span class="p">,</span> <span class="n">GattValueChangedEventArgs</span><span class="p">&gt;</span> <span class="n">valueChangedAction</span> <span class="p">=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;notification:&quot;</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Timestamp</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
    <span class="n">IBuffer</span> <span class="n">CharacteristicValue</span> <span class="p">=</span> <span class="n">a</span><span class="p">.</span><span class="n">CharacteristicValue</span><span class="p">;</span>
    <span class="kt">string</span> <span class="n">val</span> <span class="p">=</span> <span class="n">ClientBufferReader</span><span class="p">.</span><span class="n">ToUTF8String</span><span class="p">(</span><span class="n">CharacteristicValue</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;buffer content: &quot;</span> <span class="p">+</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//call the method passing the event handler</span>
<span class="n">CosmedGattCommunicationStatus</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">SubscribeToNotification</span><span class="p">(</span><span class="n">valueChangedAction</span><span class="p">);</span>
</pre></div>
</div>
<p>See also:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/uwp/api/windows.devices.bluetooth.genericattributeprofile.gattcharacteristic?view=winrt-22000">GattCharacteristic</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/uwp/api/windows.devices.bluetooth.genericattributeprofile.gattvaluechangedeventargs?view=winrt-22000">GattValueChangedEventArgs</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="GattDiscovery.html" class="btn btn-neutral float-left" title="Gatt Discovery Services" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="HelperMethods.html" class="btn btn-neutral float-right" title="Helper Methods" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Stefano Urani.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>